<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Accounts Payable - Complete Workflow</title>
    <style>
        /* Re-using styles from the context for consistency */
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            margin: 0;
            background-color: #f4f7fa;
            color: #333;
            line-height: 1.6;
        }
        h1, h2, h3 {
            color: #2c3e50;
            margin-top: 0;
        }
        a {
            color: #3498db;
            text-decoration: none;
        }
        a:hover {
            text-decoration: underline;
        }
        .container {
            display: flex;
        }
        .sidebar {
            width: 220px;
            background-color: #2c3e50;
            color: #ecf0f1;
            padding: 20px;
            height: 100vh;
            position: sticky;
            top: 0;
        }
        .sidebar h2 {
            color: #fff;
            text-align: center;
            margin-bottom: 30px;
        }
        .sidebar nav ul {
            list-style: none;
            padding: 0;
        }
        .sidebar nav li a {
            display: block;
            color: #ecf0f1;
            padding: 12px 15px;
            border-radius: 4px;
            margin-bottom: 5px;
            cursor: pointer;
        }
        .sidebar nav li a:hover, .sidebar nav li a.active {
            background-color: #34495e;
        }
        .main-content {
            flex-grow: 1;
            padding: 30px;
        }
        header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
        }
        .content-box {
            background-color: #fff;
            padding: 25px;
            border-radius: 8px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.05);
            margin-top: 20px;
        }
        /* View Content Styles */
        .view-content {
            display: none;
        }
        .view-content.active {
            display: block;
        }
        /* Form Styles */
        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
        }
        .form-group {
            display: flex;
            flex-direction: column;
        }
        .form-group label {
            margin-bottom: 5px;
            font-weight: 600;
        }
        .form-group input, .form-group select {
            padding: 10px;
            border: 1px solid #ccc;
            border-radius: 4px;
            font-size: 1em;
            font-family: inherit;
        }
        .form-group input[readonly] {
            background-color: #f4f7fa;
            cursor: not-allowed;
        }
        .form-actions {
            display: flex;
            justify-content: flex-end;
            gap: 10px;
            margin-top: 30px;
            padding-top: 20px;
            border-top: 1px solid #e0e0e0;
        }
        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 1em;
            font-weight: 500;
            transition: background-color 0.2s ease-in-out;
        }
        .btn-primary { background-color: #3498db; color: white; }
        .btn-primary:hover { background-color: #2980b9; }
        .btn-secondary { background-color: #ecf0f1; color: #333; border: 1px solid #bdc3c7; }
        .btn-secondary:hover { background-color: #bdc3c7; }
        .btn-success { background-color: #27ae60; color: white; }
        .btn-success:hover { background-color: #229954; }
        /* Table Styles */
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }
        th, td {
            text-align: left;
            padding: 12px 15px;
            border-bottom: 1px solid #e0e0e0;
        }
        th {
            background-color: #f8f9fa;
            font-weight: 600;
        }
        tbody tr:hover {
            background-color: #f1f1f1;
        }
        .status {
            padding: 4px 10px;
            border-radius: 15px;
            font-size: 0.85em;
            font-weight: 500;
            text-align: center;
            display: inline-block;
            min-width: 80px;
        }
        .status-Unapproved { background-color: #f39c12; color: #fff; }
        .status-Approved { background-color: #27ae60; color: #fff; }
        .status-Posted { background-color: #3498db; color: #fff; }
        .status-Recycle { background-color: #f1c40f; color: #333; }
        /* Chart Styles */
        .chart-area { padding-top: 20px; }
        .chart-bar { display: flex; align-items: center; margin-bottom: 15px; font-size: 0.9em; }
        .chart-label { width: 120px; color: #555; font-weight: 500; flex-shrink: 0; }
        .chart-progress-bg { flex-grow: 1; background-color: #ecf0f1; border-radius: 4px; height: 25px; overflow: hidden; }
        .chart-progress-fill { height: 100%; text-align: right; padding: 0 10px; color: white; font-weight: bold; line-height: 25px; box-sizing: border-box; white-space: nowrap; transition: width 0.5s ease-in-out; }
        .toolbar { display: flex; justify-content: space-between; align-items: center; }
    </style>
</head>
<body>

    <div class="container">
        <aside class="sidebar">
            <h2>AP Pro</h2>
            <nav id="main-nav">
                <ul>
                    <li><a data-view="enter-invoice" class="active">Enter New Invoice</a></li>
                    <li><a data-view="all-invoices">All Invoices</a></li>
                    <li><a data-view="approve-invoices">Approve Invoices</a></li>
                    <li><a data-view="reports">Reports</a></li>
                    <hr style="border-color: #34495e; margin: 10px 0;">
                    <li><a href="ap-dashboard.html">Back to Dashboard</a></li>
                </ul>
            </nav>
        </aside>

        <main class="main-content">
            <header>
                <h1 id="main-header">Enter New Invoice</h1>
                <div class="user-profile">
                    <span>Welcome, Alex!</span>
                </div>
            </header>

            <!-- View 1: Enter New Invoice -->
            <div id="enter-invoice-view" class="view-content active">
                <div class="content-box">
                    <h3>New Invoice Details</h3>
                    <form id="new-invoice-form">
                        <div class="form-grid">
                            <div class="form-group">
                                <label for="voucher-id">Voucher ID</label>
                                <input type="text" id="voucher-id" name="voucher-id" readonly>
                            </div>
                            <div class="form-group">
                                <label for="vendor">Vendor</label>
                                <select id="vendor" name="vendor" required>
                                    <option value="">Select a Vendor...</option>
                                    <option value="Innovate LLC">Innovate LLC</option>
                                    <option value="Supplier Central">Supplier Central</option>
                                    <option value="Cloud Services">Cloud Services</option>
                                    <option value="Marketing Agency">Marketing Agency</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="invoice-number">Invoice Number</label>
                                <input type="text" id="invoice-number" name="invoice-number" placeholder="e.g., INV-2024-103" required>
                            </div>
                            <div class="form-group">
                                <label for="invoice-date">Invoice Date</label>
                                <input type="date" id="invoice-date" name="invoice-date" required>
                            </div>
                            <div class="form-group">
                                <label for="amount">Total Amount</label>
                                <input type="number" id="amount" name="amount" placeholder="1250.00" step="0.01" required>
                            </div>
                        </div>
                        <div class="form-actions">
                            <button type="submit" class="btn btn-primary">Save Invoice</button>
                        </div>
                    </form>
                </div>
            </div>

            <!-- View 2: All Invoices -->
            <div id="all-invoices-view" class="view-content">
                <div class="content-box">
                    <h3>All Entered Invoices</h3>
                    <table id="all-invoices-table">
                        <thead>
                            <tr>
                                <th>Voucher ID</th>
                                <th>Vendor</th>
                                <th>Invoice #</th>
                                <th>Invoice Date</th>
                                <th>Amount</th>
                                <th>Status</th>
                            </tr>
                        </thead>
                        <tbody></tbody>
                    </table>
                </div>
            </div>

            <!-- View 3: Approve Invoices -->
            <div id="approve-invoices-view" class="view-content">
                <div class="content-box">
                    <h3>Invoices Pending Approval</h3>
                    <table id="approve-invoices-table">
                        <thead>
                            <tr>
                                <th>Voucher ID</th>
                                <th>Vendor</th>
                                <th>Invoice #</th>
                                <th>Amount</th>
                                <th>Action</th>
                            </tr>
                        </thead>
                        <tbody></tbody>
                    </table>
                </div>
            </div>

            <!-- View 4: Reports -->
            <div id="reports-view" class="view-content">
                <div class="content-box">
                    <h3>Report Filters</h3>
                    <form id="report-filters-form">
                        <div class="form-grid">
                            <div class="form-group">
                                <label for="from-date">From Date</label>
                                <input type="date" id="from-date" name="from-date" required>
                            </div>
                            <div class="form-group">
                                <label for="to-date">To Date</label>
                                <input type="date" id="to-date" name="to-date" required>
                            </div>
                            <div class="form-group">
                                <label for="voucher-status">Voucher Status</label>
                                <select id="voucher-status" name="voucher-status">
                                    <option value="All">All Statuses</option>
                                    <option value="Recycle">Recycle</option>
                                    <option value="Approved">Approved</option>
                                    <option value="Posted">Posted</option>
                                    <option value="Unapproved">Unapproved</option>
                                </select>
                            </div>
                        </div>
                        <div class="form-actions" style="border-top: none; padding-top: 0;">
                            <button type="submit" class="btn btn-primary">Run Report</button>
                        </div>
                    </form>
                </div>

                <div id="report-results" style="display: none;">
                    <div class="content-box">
                        <h3>Graphical Summary</h3>
                        <div id="chart-area" class="chart-area"></div>
                    </div>

                    <div class="content-box">
                        <div class="toolbar">
                            <h3>Voucher Details</h3>
                            <button id="export-csv-btn" class="btn btn-secondary">Export to CSV</button>
                        </div>
                        <table id="report-table">
                            <thead>
                                <tr>
                                    <th>Voucher ID</th>
                                    <th>Vendor</th>
                                    <th>Invoice Date</th>
                                    <th>Amount</th>
                                    <th>Status</th>
                                </tr>
                            </thead>
                            <tbody id="report-table-body"></tbody>
                        </table>
                    </div>
                </div>
            </div>
        </main>
    </div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    // --- MOCK DATA & STATE ---
    let nextVoucherId = 115;
    const mockInvoices = [
        { voucherId: 'V00109', vendor: 'Marketing Agency', invoiceNumber: 'MA-2024-08', date: '2024-08-05', amount: 3200.00, status: 'Approved' },
        { voucherId: 'V00110', vendor: 'Cloud Services', invoiceNumber: 'CS-8891', date: '2024-08-05', amount: 1150.00, status: 'Unapproved' },
        { voucherId: 'V00111', vendor: 'Office Supplies Co.', invoiceNumber: 'OS-9912', date: '2024-08-06', amount: 375.50, status: 'Posted' },
        { voucherId: 'V00112', vendor: 'Innovate LLC', invoiceNumber: 'INV-2024-112', date: '2024-08-10', amount: 22000.00, status: 'Unapproved' },
        { voucherId: 'V00113', vendor: 'Supplier Central', invoiceNumber: 'SC-551', date: '2024-07-28', amount: 4500.00, status: 'Posted' },
        { voucherId: 'V00114', vendor: 'Marketing Agency', invoiceNumber: 'MA-2024-09', date: '2024-07-25', amount: 1200.00, status: 'Recycle' },
    ];

    // --- DOM CACHING ---
    const mainNav = document.getElementById('main-nav');
    const mainHeader = document.getElementById('main-header');
    const viewContents = document.querySelectorAll('.view-content');
    
    // Invoice Entry
    const newInvoiceForm = document.getElementById('new-invoice-form');
    const voucherIdInput = document.getElementById('voucher-id');
    const invoiceDateInput = document.getElementById('invoice-date');
    
    // Tables
    const allInvoicesTbody = document.querySelector('#all-invoices-table tbody');
    const approveInvoicesTbody = document.querySelector('#approve-invoices-table tbody');
    
    // Reports
    const reportForm = document.getElementById('report-filters-form');
    const resultsContainer = document.getElementById('report-results');
    const reportTableBody = document.getElementById('report-table-body');
    const chartArea = document.getElementById('chart-area');
    const exportBtn = document.getElementById('export-csv-btn');

    // --- UTILITY FUNCTIONS ---
    const formatCurrency = (value) => new Intl.NumberFormat('en-US', { style: 'currency', currency: 'USD' }).format(value);

    // --- VIEW & NAVIGATION LOGIC ---
    const showView = (viewId) => {
        const activeLink = mainNav.querySelector(`a[data-view="${viewId}"]`);
        if (!activeLink) return;

        mainHeader.textContent = activeLink.textContent;
        mainNav.querySelectorAll('a[data-view]').forEach(link => link.classList.remove('active'));
        activeLink.classList.add('active');

        viewContents.forEach(content => {
            content.classList.toggle('active', content.id === `${viewId}-view`);
        });
    };

    // --- RENDERING FUNCTIONS ---
    const renderAllTables = () => {
        renderAllInvoices();
        renderApprovableInvoices();
    };

    const renderAllInvoices = () => {
        allInvoicesTbody.innerHTML = '';
        if (mockInvoices.length === 0) {
            allInvoicesTbody.innerHTML = '<tr><td colspan="6" style="text-align:center;">No invoices found.</td></tr>';
            return;
        }
        mockInvoices.sort((a, b) => b.voucherId.localeCompare(a.voucherId)).forEach(inv => {
            const row = document.createElement('tr');
            row.innerHTML = `
                <td>${inv.voucherId}</td>
                <td>${inv.vendor}</td>
                <td>${inv.invoiceNumber}</td>
                <td>${inv.date}</td>
                <td>${formatCurrency(inv.amount)}</td>
                <td><span class="status status-${inv.status}">${inv.status}</span></td>
            `;
            allInvoicesTbody.appendChild(row);
        });
    };

    const renderApprovableInvoices = () => {
        approveInvoicesTbody.innerHTML = '';
        const unapproved = mockInvoices.filter(inv => inv.status === 'Unapproved');
        if (unapproved.length === 0) {
            approveInvoicesTbody.innerHTML = '<tr><td colspan="5" style="text-align:center;">No invoices are pending approval.</td></tr>';
            return;
        }
        unapproved.forEach(inv => {
            const row = document.createElement('tr');
            row.innerHTML = `
                <td>${inv.voucherId}</td>
                <td>${inv.vendor}</td>
                <td>${inv.invoiceNumber}</td>
                <td>${formatCurrency(inv.amount)}</td>
                <td><button class="btn btn-success btn-sm approve-btn" data-id="${inv.voucherId}">Approve</button></td>
            `;
            approveInvoicesTbody.appendChild(row);
        });
    };

    // --- INVOICE WORKFLOW LOGIC ---
    const updateVoucherId = () => {
        voucherIdInput.value = `V00${nextVoucherId}`;
    };

    const handleFormSubmit = (e) => {
        e.preventDefault();
        const formData = new FormData(newInvoiceForm);
        const vendor = formData.get('vendor');
        const invoiceNumber = formData.get('invoice-number');
        const invoiceDate = formData.get('invoice-date');

        // Date validation
        const today = new Date();
        today.setHours(0, 0, 0, 0); // Set to midnight for fair comparison
        const selectedDate = new Date(invoiceDate + 'T00:00:00'); // Adjust for timezone issues

        if (selectedDate > today) {
            alert('Error: Invoice date cannot be in the future.');
            return;
        }

        // Duplicate check
        const isDuplicate = mockInvoices.some(inv => inv.vendor === vendor && inv.invoiceNumber === invoiceNumber);
        if (isDuplicate) {
            alert(`Error: A duplicate invoice already exists for vendor "${vendor}" with invoice number "${invoiceNumber}".`);
            return;
        }

        mockInvoices.push({
            voucherId: voucherIdInput.value,
            vendor: vendor,
            invoiceNumber: invoiceNumber,
            date: invoiceDate,
            amount: parseFloat(formData.get('amount')),
            status: 'Unapproved'
        });
        nextVoucherId++;

        alert(`Invoice ${voucherIdInput.value} saved successfully!`);
        newInvoiceForm.reset();
        updateVoucherId();
        renderAllTables();
        showView('all-invoices');
    };

    const handleApproval = (e) => {
        if (!e.target.classList.contains('approve-btn')) return;
        const voucherIdToApprove = e.target.dataset.id;
        const invoice = mockInvoices.find(inv => inv.voucherId === voucherIdToApprove);
        if (invoice) {
            invoice.status = 'Approved';
            renderAllTables();
        }
    };

    // --- REPORTING LOGIC ---
    const handleReportRun = (e) => {
        e.preventDefault();
        const fromDateStr = document.getElementById('from-date').value;
        const toDateStr = document.getElementById('to-date').value;
        const status = document.getElementById('voucher-status').value;

        if (!fromDateStr || !toDateStr) {
            alert("Please select both a From and To date.");
            return;
        }

        const fromDate = new Date(fromDateStr + 'T00:00:00');
        const toDate = new Date(toDateStr + 'T23:59:59');

        const filteredData = mockInvoices.filter(v => {
            const vDate = new Date(v.date + 'T00:00:00');
            const statusMatch = (status === 'All' || v.status === status);
            return vDate >= fromDate && vDate <= toDate && statusMatch;
        });

        populateReportTable(filteredData);
        createReportChart(filteredData);
        resultsContainer.style.display = 'block';
    };

    const populateReportTable = (data) => {
        reportTableBody.innerHTML = '';
        if (data.length === 0) {
            reportTableBody.innerHTML = '<tr><td colspan="5" style="text-align:center;">No data found for the selected criteria.</td></tr>';
            return;
        }
        data.forEach(v => {
            reportTableBody.innerHTML += `
                <tr>
                    <td><a href="#">${v.voucherId}</a></td>
                    <td>${v.vendor}</td>
                    <td>${v.date}</td>
                    <td>${formatCurrency(v.amount)}</td>
                    <td><span class="status status-${v.status}">${v.status}</span></td>
                </tr>`;
        });
    };

    const createReportChart = (data) => {
        chartArea.innerHTML = '';
        const summary = data.reduce((acc, v) => {
            if (!acc[v.status]) acc[v.status] = { count: 0, totalAmount: 0 };
            acc[v.status].count++;
            acc[v.status].totalAmount += v.amount;
            return acc;
        }, {});

        const maxAmount = Math.max(1, ...Object.values(summary).map(s => s.totalAmount));

        for (const status in summary) {
            const item = summary[status];
            const percentage = (item.totalAmount / maxAmount) * 100;
            chartArea.innerHTML += `
                <div class="chart-bar">
                    <div class="chart-label">${status} (${item.count})</div>
                    <div class="chart-progress-bg">
                        <div class="chart-progress-fill status-${status}" style="width: ${percentage}%;">
                            ${formatCurrency(item.totalAmount)}
                        </div>
                    </div>
                </div>`;
        }
    };

    const handleCSVExport = () => {
        const table = document.getElementById('report-table');
        let csv = [];
        for (const row of table.rows) {
            const rowData = [];
            for (const cell of row.cells) {
                let text = cell.innerText.replace(/(\r\n|\n|\r)/gm, "").replace(/(\s\s)/gm, " ");
                text = text.replace(/"/g, '""');
                rowData.push(`"${text}"`);
            }
            csv.push(rowData.join(','));
        }
        
        const link = document.createElement("a");
        link.href = 'data:text/csv;charset=utf-8,' + encodeURI(csv.join('\n'));
        link.download = "voucher_report.csv";
        document.body.appendChild(link);
        link.click();
        document.body.removeChild(link);
    };

    const setDefaultReportDates = () => {
        const today = new Date();
        const firstDayOfMonth = new Date(today.getFullYear(), today.getMonth(), 1);
        document.getElementById('to-date').valueAsDate = today;
        document.getElementById('from-date').valueAsDate = firstDayOfMonth;
    };

    // --- EVENT LISTENERS ---
    mainNav.addEventListener('click', (e) => {
        if (e.target.matches('a[data-view]')) {
            e.preventDefault();
            showView(e.target.dataset.view);
        }
    });

    newInvoiceForm.addEventListener('submit', handleFormSubmit);
    approveInvoicesTbody.addEventListener('click', handleApproval);
    reportForm.addEventListener('submit', handleReportRun);
    exportBtn.addEventListener('click', handleCSVExport);

    // --- INITIALIZATION ---
    updateVoucherId();
    renderAllTables();
    setDefaultReportDates();
    showView('enter-invoice'); // Set the initial view
});
</script>

</body>
</html>


